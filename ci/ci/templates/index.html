<html lang="en">
  <head>
    <title>CI</title>
    <link rel="stylesheet" type="text/css" href="/static/style.css">
    <style>
      #statuses {
        border-collapse: collapse;
      }
      #statuses td, #statuses th {
        border: 1px solid #ddd;
        padding: 8px;
      }
      #statuses tr:nth-child(even){background-color: #f2f2f2;}
      #statuses tr:hover {background-color: #ddd;}
      #statuses th {
        padding-top: 12px;
        padding-bottom: 12px;
        text-align: left;
        background-color: #2A388F;
        color: white;
      }
    </style>
  </head>
  <body>
    <h1>CI</h1>
    {% for wb in watched_branches %}
    <h2>{{ wb.branch }}</h2>
    <p>SHA:
      {% if wb.sha is not none %}
      {{ wb.sha }}
      {% else %}
      unknown
      {% endif %}
    </p>
    <p>Deploy State:
      {% if wb.deploy_state is not none %}
      {{ wb.deploy_state }}
      {% endif %}
    </p>
    <p>Deploy Batch: 
      {% if wb.deploy_batch_id is not none %}
      <a href="/batches/{{ wb.deploy_batch_id }}">{{ wb.deploy_batch_id }}</a>
      {% endif %}
    </p>

    <h3>PRs</h3>
    {% if wb.prs is not none %}
    {% if wb.prs|length > 0 %}
    <table id="statuses" class="searchable sortable">
      <thead>
        <tr>
          <th align="left">Number</th>
          <th align="left">Title</th>
          <th align="left">Build State</th>
          <th align="left">Review State</th>
          <th align="left">Author</th>
        </tr>
      </thead>
      <tbody>
        {% for pr in wb.prs %}
        <tr>
          <td align="left">
            <a href="https://github.com/{{ wb.repo }}/pull/{{ pr.number }}">
              {{ pr.number }}
            </a>
          </td>
          <td align="left">
            {{ pr.title }}
          </td>
          <td align="left">
            <a href="/watched_branches/{{ wb.index }}/pr/{{ pr.number }}">
            {% if pr.build_state is not none %}
              {{ pr.build_state }}{% if not pr.is_up_to_date() %}*{% endif %}
            {% elif pr.batch_id is not none %}
              building{% if not pr.is_up_to_date() %}*{% endif %}
            {% else %}
              pending{% if not pr.is_up_to_date() %}*{% endif %}
            {% endif %}
            </a>
          </td>
          <td align="left">
            {% if pr.review_state %}
            {{ pr.review_state }}
            {% endif %}
          </td>
          <td align="left">
            {{ pr.author }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    No PRs.
    {% endif %}
    {% else %}
    Unknown.
    {% endif %}
    {% endfor %}

    <h2>Authorize SHA</h2>
    <form action="/authorize_source_sha" method="post">
      <label for="sha">SHA:</label>
      <input type="text" name="sha" id="sha">
      <button type="submit">Authorize</button>
    </form>
  </body>
</html>
